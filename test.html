<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title></title>
    <style>
        div#header {
            width: 100%;
            background: green;
        }

        div#container {
            width: 100%;
            margin-bottom: 50px;
            margin-top: 50px;
            background: limegreen;
            /*display: block;*/
        }

        div#footer {
            width: 100%;
            clear: both;
            background: green;
            position: absolute;
            bottom: 0;
            left: 0;
        }

        div.center {
            text-align: center;
            width: 80%;
            display: block;
            margin-right: auto;
            margin-left: auto;
        }

            /*button {*/
            /*height: 150px;*/
            /*width: 150px;*/
            /*}*/

        .hidden {
            visibility: hidden;
        }

        .visible {
            visibility: visible;
        }
    </style>
    <script src="js/jquery-1.8.3.js"></script>
    <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
    <script src="js/bootstrap.min.js"></script>
    <script>

        $(function () {
            $("canvas").click(
                    function (e) {
                        checkNeighbours(this.id);
                        if (isGameFinished())
                            alert("game finished!");
                    }
            )
        });
        function isGameFinished() {
            for (var i = 0; i < 8; i++) {
                if (parseInt($("#" + i).attr("ind")) != i) {
                    return false;
                }
            }
            return true;
        }
        function checkNeighbours(cId) {
            var id = parseInt(cId);
            var top = id - 3;

            var left = -1;
            var right = -1;

            if (id % 3 != 2)
                right = id + 1;

            if (id % 3 != 0)
                left = id - 1;

            var down = id + 3;

            var target = null;

            if ($("#" + top).css("visibility") == "hidden")
                target = top;
            else if ($("#" + left).css("visibility") == "hidden")
                target = left;
            else if ($("#" + right).css("visibility") == "hidden")
                target = right;
            else if ($("#" + down).css("visibility") == "hidden")
                target = down;

            if (target != null) {
//                $("#" + id).hide();
//                $("#" + target).show();
                $("#" + id).css("visibility", "hidden");
                $("#" + target).css("visibility", "visible");
                getCanvas(target).drawImage($("#" + id)[0], 0, 0);
//                $("#" + target).css("background-image", $("#" + id).css("background-image"));
                $("#" + target).attr("ind", $("#" + id).attr("ind"));
            }

        }

        function getRandomArray() {
            var arr = [];
            while (arr.length < 8) {
                var randomnumber = Math.floor((Math.random() * 8));
                var found = false;
                for (var i = 0; i < arr.length; i++) {
                    if (arr[i] == randomnumber) {
                        found = true;
                        break
                    }
                }
                if (!found)arr[arr.length] = randomnumber;

            }
            return arr;
        }

        var img=new Image();

        function changeImage() {


//            var img = document.getElementById("kk");
            var karajan = getCanvas("karajan");
            karajan.clearRect(0, 0, karajan.width, karajan.height);
            karajan.drawImage(img, 0, 0, img.width, img.height, 0, 0, 450, 450);

            var arr = getRandomArray();

            for (var i = 0; i < 3; i++) {
                for (var j = 0; j < 3; j++) {
//                    var dx = ((j == 0) ? 0 : j * 150 + j * 10);
//                    var dy = ((i == 0) ? 0 : i * 150 + i * 10);

                    var k = i * 3 + j;

                    if (k > 7) continue;

                    getCanvas(arr[k]).drawImage($("#karajan")[0], j * 150, i * 150, 150, 150, 0, 0, 150, 150);
                    $("#" + k).attr("ind", arr[k]);
                }
            }
        }

        function drawImage(event) {

//            alert("here");
            if (event.target.files.length <= 0) return;
            var files = event.target.files;
            var URL = window.URL || window.webkitURL;
//            var img = document.getElementById("kk");
//            var img = document.getElementById("karajan");

            img.src = URL.createObjectURL(files[0]);
            img.onload = changeImage;
//            img.reload();
//            setTimeout(drawImage, 1000);
//            canvas.width = "450";
//            canvas.height = "450";


        }

        function getCanvas(id) {
            var canvas = $("#" + id)[0];
            if (canvas.getContext) {
                return canvas.getContext("2d");
            }
            return undefined;
        }

    </script>
</head>
<body>
<div id="header">
    <div class="navbar navbar-inverse" style="position: static;">
        <div class="navbar-inner">
            <div class="container">
                <a class="btn btn-navbar" data-toggle="collapse" data-target=".navbar-inverse-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </a>
                <a class="brand" href="#">Title</a>

                <div class="nav-collapse collapse navbar-inverse-collapse">
                    <ul class="nav">
                        <li class="active"><a href="#">Home</a></li>
                        <li><a href="#">Link</a></li>
                        <li><a href="#">Link</a></li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown <b
                                    class="caret"></b></a>
                            <ul class="dropdown-menu">
                                <li><a href="#">Action</a></li>
                                <li><a href="#">Another action</a></li>
                                <li><a href="#">Something else here</a></li>
                                <li class="divider"></li>
                                <li class="nav-header">Nav header</li>
                                <li><a href="#">Separated link</a></li>
                                <li><a href="#">One more separated link</a></li>
                            </ul>
                        </li>
                    </ul>
                    <form class="navbar-search pull-left" action="">
                        <input type="text" class="search-query span2" placeholder="Search">
                    </form>
                    <ul class="nav pull-right">
                        <li><a href="#">Link</a></li>
                        <li class="divider-vertical"></li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown <b
                                    class="caret"></b></a>
                            <ul class="dropdown-menu">
                                <li><a href="#">Action</a></li>
                                <li><a href="#">Another action</a></li>
                                <li><a href="#">Something else here</a></li>
                                <li class="divider"></li>
                                <li><a href="#">Separated link</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
                <!-- /.nav-collapse -->
            </div>
        </div>
        <!-- /navbar-inner -->
    </div>
</div>
<div id="container">
    <canvas id="karajan" height="452px" width="452px" style="display: none;"></canvas>
    <!--<img src="img/k1.jpg" id="kk">-->

    <div class="center">
        <div>
            <canvas width="150" height="150" id="0"></canvas>
            <canvas width="150" height="150" id="1"></canvas>
            <canvas width="150" height="150" id="2"></canvas>
        </div>
        <div>
            <canvas width="150" height="150" id="3"></canvas>
            <canvas width="150" height="150" id="4"></canvas>
            <canvas width="150" height="150" id="5"></canvas>
        </div>
        <div>
            <canvas width="150" height="150" id="6"></canvas>
            <canvas width="150" height="150" id="7"></canvas>
            <canvas width="150" height="150" id="8" style="visibility: hidden;"></canvas>
        </div>
    </div>
</div>
<!--<section>-->
<!--<canvas width="150" height="150">-->
<!--Not supported-->
<!--</canvas>-->
<!--</section>-->
<p>
    <button onclick="drawImage()">Shuffle</button>
    <input type="file" accept="image/*" id="image_input" onchange="drawImage(event)"/>
</p>

</body>
</html>